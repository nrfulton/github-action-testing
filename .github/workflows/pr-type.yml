name: PR Comment Bot

on:
  pull_request_target:
    types: [opened]

jobs:
  add-comment:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Detect PR type from checkboxes
        id: detect-type
        env:
          PR_BODY: ${{ github.event.pull_request.body }}
        run: |
          PR_TYPE=""

          # Check for checked boxes (supports [x] and [X])
          if echo "$PR_BODY" | grep -qi '\[x\] Bug fix'; then
            PR_TYPE="bug"
          elif echo "$PR_BODY" | grep -qi '\[x\] Feature'; then
            PR_TYPE="feature"
          elif echo "$PR_BODY" | grep -qi '\[x\] Documentation'; then
            PR_TYPE="documentation"
          fi

          echo "pr_type=$PR_TYPE" >> "$GITHUB_OUTPUT"
          echo "Detected PR type: $PR_TYPE"

      - name: Post comment based on PR type
        if: steps.detect-type.outputs.pr_type != ''
        uses: mshick/add-pr-comment@b8f338c590a895d50bcbfa6c5859251edc8952fc
        with:
          message-path: | 
            .github/PULL_REQUEST_TEMPLATE/${{ steps.detect-type.outputs.pr_type }}.md
            .github/PULL_REQUEST_TEMPLATE/default.md
        
        # TODO: JAL. Do the path construction as a part of the PR script, then just include that in message-path...; must be a new line
        # TODO: JAL. see if others can edit the comment once posted
        # TODO: JAL.